#!/usr/bin/env pwsh

# Guide-to-Install-Frappe-ERPNext-in-Windows-11-Using-Docker
# A complete Guide to Install Frappe Bench in Windows 11 Using Docker and install Frappe/ERPNext Application

Write-Output "### STEP 3: Create devcontainer and VS Code setup"
Copy-Item -Recurse devcontainer-example .devcontainer
Copy-Item -Recurse development/vscode-example development/.vscode

# Only on macOS with M1 or M2; check arm or amd platform
if ((docker version --format '{{.Server.Arch}}') -eq "arm64") {
    Write-Output "### Update devcontainer and docker-compose for M1/M2"
    Move-Item .devcontainer/devcontainer.json .devcontainer/devcontainer.json.ORIG
    (Get-Content .devcontainer/devcontainer.json.ORIG) -replace 'linux/amd64', 'linux/arm64' | Set-Content .devcontainer/devcontainer.json
    Move-Item .devcontainer/docker-compose.yml .devcontainer/docker-compose.yml.ORIG
    (Get-Content .devcontainer/docker-compose.yml.ORIG) -replace 'linux/amd64', 'linux/arm64' | Set-Content .devcontainer/docker-compose.yml
}

Write-Output "### STEP 4 Open vscode and install 'Dev Containers' extension"
Write-Output "###  STEP 5 Open frappe_docker folder in VS Code."
Write-Output ""
Write-Output "--> NOW: Launch the command, from Command Palette (Ctrl + Shift + P) Remote-Containers: Reopen in Container. You can also click in the bottom left corner to access the remote container menu."